<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ù„Ù Ø§Ù„Ø·Ø§Ù„Ø¨Ø©</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo&family=Scheherazade&display=swap" rel="stylesheet">
<style>
body { font-family:'Cairo',sans-serif; margin:0; background:#d0f0fd; display:flex; justify-content:center; padding:20px;}
.profile-container { width:100%; max-width:900px; }
.header-glitter { font-family:'Scheherazade', serif; font-size:3rem; text-align:center; font-weight:bold; color:#FFD700; text-shadow:0 0 10px #fff,0 0 20px #FFD700,0 0 30px #fff; margin-bottom:20px; animation: shimmer 2s infinite alternate; }
@keyframes shimmer { 0%{ text-shadow:0 0 10px #fff,0 0 20px #FFD700,0 0 30px #fff; } 100%{ text-shadow:0 0 15px #fff,0 0 30px #FFD700,0 0 45px #fff; } }
.info-box { background:#e6ffe6; padding:15px 20px; border-radius:12px; margin-bottom:20px; box-shadow:0 5px 15px rgba(0,0,0,0.1);}
.info-item { margin:6px 0; display:flex; align-items:center; gap:8px;}
.info-item i { color:#2E7D32; }
.notes { color:#d32f2f; font-weight:bold; animation: blink 1s infinite; }
@keyframes blink {0%{opacity:1;}50%{opacity:0.3;}100%{opacity:1;}}
.photo-box { text-align:center; margin-bottom:20px; position:relative; }
.photo-box img { width:150px; height:150px; border-radius:50%; object-fit:cover; border:4px solid #FFD700; cursor:pointer; transition: transform 0.3s; }
.photo-box img:hover { transform: scale(1.08); }
.modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; }
.modal img { max-width:80%; max-height:80%; border-radius:10px; }

.section { background:#ffffffcc; border-radius:12px; padding:12px 16px; margin-bottom:20px; box-shadow:0 4px 10px rgba(0,0,0,0.08); opacity:0; transform:translateY(20px); transition:all 0.6s ease; }
.section.show { opacity:1; transform:translateY(0); }
.section h2 { font-size:1.6rem; margin-bottom:10px; color:#2E7D32; display:flex; align-items:center; gap:10px; }

.item { margin:5px 0; padding:6px 10px; border-radius:6px; display:flex; align-items:center; justify-content:space-between; background:#f1f1f1; position:relative; transition:transform 0.3s; }
.item.homework { background:#d0f0d0; cursor:pointer; }
.item.homework:hover { transform: scale(1.03); box-shadow:0 3px 10px #32CD32; }
.item.ranking { background:#fff3cd; }
.sparkle { position:absolute; width:6px; height:6px; background:gold; border-radius:50%; top:0; left:0; animation: sparkle 1.5s infinite; }
@keyframes sparkle { 0% { transform: scale(0.5) translate(0,0); opacity:1;} 50% { transform: scale(1.2) translate(5px,5px); opacity:0.7;} 100% { transform: scale(0.5) translate(0,0); opacity:1;} }

.course-box { background:#e0f7fa; padding:12px; border-radius:10px; margin:8px 0; transition: transform 0.25s, box-shadow 0.25s; cursor:pointer; display:flex; justify-content:space-between; align-items:center;}
.course-box:hover { transform:scale(1.03); box-shadow:0 6px 12px rgba(0,0,0,0.12); }
.course-registered { border:2px solid #2E7D32; background:#c8f7c5; }
.register-btn { background:#32CD32; color:white; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; margin-left:10px; transition:0.3s; }
.register-btn:hover { background:#228B22; }

nav { text-align:center; margin-bottom:15px; }
nav a { text-decoration:none; color:#fff; background:#2E7D32; padding:10px 15px; border-radius:10px; margin:0 5px; transition:0.25s; }
nav a:hover { background:#FFD700; color:#000; }

@media(max-width:700px){ .photo-box img{width:120px;height:120px;} }
@media(max-width:420px){ nav a{display:block;margin:5px 0;} }
</style>
</head>
<body>
<div class="profile-container">

<header class="header-glitter" id="glitterHeader">Ø§Ù„Ø·Ø§Ù„Ø¨Ø©</header>

<nav>
  <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  <a href="ranks.html">Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</a>
  <a href="gallery.html">Ø§Ù„Ù…Ø¹Ø±Ø¶</a>
  <a href="login.html">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
</nav>

<div class="photo-box">
  <img id="studentPhoto" src="" alt="ØµÙˆØ±Ø© Ø§Ù„Ø·Ø§Ù„Ø¨Ø©">
</div>

<div class="info-box" id="infoBox">
  <div class="info-item"><i>ğŸ‘¤</i> <span id="studentName"></span></div>
  <div class="info-item"><i>ğŸ“</i> Ø§Ù„ØµÙ/Ø§Ù„ÙˆØ¸ÙŠÙØ©: <span id="studentGrade"></span></div>
  <div class="info-item"><i>ğŸ“…</i> Ø§Ù„Ø¹Ù…Ø±: <span id="studentAge"></span></div>
  <div class="info-item"><i>ğŸ“–</i> Ù…Ø§ Ø­ÙØ¸Ù‡: <span id="studentQuran"></span></div>
  <div class="info-item notes" id="studentNotes"></div>
</div>

<div class="section" id="achievementsSection">
  <h2>Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</h2>
  <div id="achievementsContainer"></div>
</div>

<div class="section" id="homeworkSection">
  <h2>Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</h2>
  <div id="homeworkContainer"></div>
</div>

<div class="section" id="rankingsSection">
  <h2>Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h2>
  <div id="rankingsContainer"></div>
</div>

<div class="section" id="coursesSection">
  <h2>Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
  <div id="coursesContainer"></div>
</div>

</div>

<div class="modal" id="photoModal"><img src="" alt="ØµÙˆØ±Ø© Ø§Ù„Ø·Ø§Ù„Ø¨Ø©"></div>

<script>
// ===== Config =====
const scriptURL = "https://script.google.com/macros/s/AKfycbyW-GfeDlzrygGp3GsOrHckdVLzw4ZhUUXvqwpWHPeyub1HRsaACQZ9qEMQ63lL96Vg/exec";

// Check login
let studentUsername = sessionStorage.getItem('studentLoggedIn') || localStorage.getItem('studentLoggedIn');
if(!studentUsername){ alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„!"); window.location.href="login.html?redirect=student.html"; }

// Fetch Student Data
fetch(`${scriptURL}?action=getStudent&username=${encodeURIComponent(studentUsername)}`)
.then(res=>res.json())
.then(data=>{
  if(data.success && data.student){
    const stu = data.student;
    document.getElementById('studentName').textContent = stu.Name || "-";
    document.getElementById('studentGrade').textContent = stu.Grade || "-";
    document.getElementById('studentAge').textContent = stu.Age || "-";
    document.getElementById('studentQuran').textContent = stu['quran memorized'] || "-";
    document.getElementById('studentNotes').textContent = stu.notes || "-";
    document.getElementById('studentPhoto').src = stu['photo URL'] || 'student-placeholder.png';
    document.getElementById('photoModal').querySelector('img').src = stu['photo URL'] || 'student-placeholder.png';

    // Achievements
    const achContainer = document.getElementById('achievementsContainer');
    (stu['achievements or awards']||"").split(",").forEach(a=>{
      if(a.trim()!==""){
        const div = document.createElement('div'); div.className="item ranking"; div.textContent=a;
        for(let i=0;i<5;i++){ const s=document.createElement('div'); s.className='sparkle'; s.style.top=Math.random()*100+'%'; s.style.left=Math.random()*100+'%'; div.appendChild(s);}
        achContainer.appendChild(div);
      }
    });

    // Homework
    const hwContainer = document.getElementById('homeworkContainer');
    (stu['ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹']||"").split(",").forEach(hw=>{
      if(hw.trim()!==""){
        const div = document.createElement('div'); div.className="item homework"; div.textContent=hw;
        hwContainer.appendChild(div);
      }
    });

    // Last rankings
    const rankContainer = document.getElementById('rankingsContainer');
    (stu['Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©']||"").split(",").forEach(r=>{
      if(r.trim()!==""){ const div=document.createElement('div'); div.className="item ranking"; div.textContent=r; rankContainer.appendChild(div);}
    });

    // Courses & registration
    fetch(`${scriptURL}?action=getCourses`).then(res=>res.json()).then(cdata=>{
      if(cdata.success && cdata.courses){
        const container = document.getElementById('coursesContainer');
        cdata.courses.forEach(c=>{
          const div=document.createElement('div'); div.className="course-box";
          let registered = stu['courses'] && stu['courses'].includes(c['Course Name']);
          if(registered) div.classList.add('course-registered');
          div.innerHTML=`<span><strong>${c['Course Name']}</strong> - ${c['DESCRIPTION']}</span>`;
          const btn = document.createElement('button'); btn.className='register-btn';
          btn.textContent = registered?"ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„":"ØªØ³Ø¬ÙŠÙ„";
          btn.onclick = ()=>{
            fetch(`${scriptURL}?action=registerCourse&username=${encodeURIComponent(studentUsername)}&courseName=${encodeURIComponent(c['Course Name'])}`)
            .then(r=>r.json()).then(res=>{
              if(res.success){ btn.textContent="ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„"; div.classList.add('course-registered'); alert("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ø¯ÙˆØ±Ø©!"); }
              else alert(res.message||"Ø­Ø¯Ø« Ø®Ø·Ø£!");
            }).catch(e=>alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„!"));
          };
          div.appendChild(btn);
          container.appendChild(div);
        });
      }
    });

  } else { alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©!"); window.location.href="login.html"; }
}).catch(e=>{ alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…!"); console.error(e); });

// Photo modal
const photo=document.getElementById('studentPhoto'); const modal=document.getElementById('photoModal');
photo.addEventListener('click',()=>{ modal.style.display='flex'; });
modal.addEventListener('click',()=>{ modal.style.display='none'; });

// Fade-in sections
const observer = new IntersectionObserver(entries=>{ entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('show'); });},{threshold:0.2});
document.querySelectorAll('.section').forEach(s=>observer.observe(s));
</script>
</body>
</html>
